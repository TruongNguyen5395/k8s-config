Vagrant.configure("2") do |config|
  config.vm.box = "bento/ubuntu-20.10" 
  

  config.vm.define "nfs" do |nfs|
    nfs.vm.network "public_network", ip: "192.168.1.15", bridge: "eno1"
    nfs.vm.hostname = "nfs"

    nfs.vm.provider "virtualbox" do |vb|
      vb.memory = "4096"
      vb.cpus = 4
      vb.gui = true
    end
  end

  config.vm.define "k3s_master" do |k3s_master| 
    k3s_master.vm.network "public_network", ip: "192.168.1.16", bridge: "eno1"
    k3s_master.vm.hostname = "k3s-master"
    k3s_master.vm.provider "virtualbox" do |vb|
      
      vb.memory = "4096"
      vb.cpus = 4
    end
  end

  config.vm.define "k3s_node" do |k3s_node| 
    k3s_node.vm.hostname = "k3s-node"
    k3s_node.vm.network "public_network", ip: "192.168.1.17" , bridge: "eno1"
    k3s_node.vm.provider "virtualbox" do |vb|
      vb.memory = "4096"
      vb.cpus = 4
    end
  end


  config.vm.provision "ansible" do |ansible| 
    # ansible.verbose = "-vvvv"
    # ansible.galaxy_role_file = 'requirements.yml'
    ansible.playbook = "playbook.yml"
    ansible.limit = "all"
    # ansible.tags = ["k3s-master-config"]
    ansible.groups = {
        "db-servers" => ["nfs"],
        "k3s_cluster" => ["k3s_master","k3s_node"]
      } 

  end
end